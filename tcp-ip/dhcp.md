## 动态主机配置协议（Dynamic Host Configuration Protocol, DHCP）
为了使用 TCP/IP 协议族，每台主机和路由器需要一定的配置信息，比如本地 IP 地址、子网掩码、路由器的 IP 地址、DNS 服务器的 IP 地址等。DHCP 是一种流行的客户机/服务器协议，用于为主机（有时也为路由器）指定配置信息。

DHCP 由两个主要部分组成：地址管理和配置数据交付。地址管理用于 IP 地址的动态分配，并为客户机提供地址租用；配置数据交付包括 DHCP 协议的消息格式和状态机。DHCP 服务器可配置为提供三种地址分配：自动分配、动态分配和手动分配。

当一台新的客户机连接到网络时，它首先发现可用的 DHCP 服务器地址，以及它们能提供的地址。然后，它决定使用哪台服务器和哪个地址，并向提供该地址的服务器发送请求（同时将其选择通知所有服务器）。除非服务器在此期间将地址分配出去，否则它通过确认将地址分配给请求的客户机。

一次典型的 DHCP 交换过程如下：
1. 客户机首先（用 UDP）广播一个 DHCPDISCOVER 消息，试图找到网络中的 DHCP 服务器。
2. 对于接收到请求的每台服务器，无论直接接收还是通过中继代理，他们都会响应一个 DHCPOFFER 消息，并在“你的”IP地址字段中填入提供的 IP 地址。其他配置选项（例如 DNS 服务器的 IP 地址、子网掩码）也经常包括在内。
3. 客户机接收到来自一台或多台服务器的 DHCPOFFER 消息后，客户机确定自己想接受哪个 DHCPOFFER，并（UDP）广播一个有服务器标识（服务器 IP 地址）选项的 DHCPREQUEST 消息。请求的 IP 地址选项设置为由选中的 DHCPOFFER 消息提供的地址。
4. 多台服务器可能接收到（UDP）广播的 DHCPREQUEST 消息，但只有 DHCPREQUEST 消息中表示的服务器同意将该地址进行绑定；其他服务器清除与该请求相关的状态。在完成绑定后，选中的服务器响应一个 DHCPACK 消息，通知客户机现在可使用该地址。如果无法分配，该服务器将会响应一个 DHCPNAK 消息。
5. 当客户机接收到 DHCPACK 消息和其他相关的配置信息时，它可以探测网络以确保获得的地址未被使用。如果客户机确定该地址已被使用，就不使用该地址，并向服务器发送一个 SHCPDECLINE 消息，通知该地址不能使用。在经过默认 10 秒后，客户机可重试。